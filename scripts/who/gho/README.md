# Importing WHO GHO Data Into Data Commons

Author: chejennifer

## Table of Contents

1. [About the Dataset](#about-the-dataset)
1. [Import Procedure](#import-procedure)
1. [Categories to StatVar Groups](#categories-to-svgroups)

## About the Dataset

### Overview
This directory imports [WHO GHO Data](https://www.who.int/data/gho) into Data Commons. The WHOâ€™s Global Health Observatory website provides access to data for over 2300 indicators and each indicator can be further broken down by 0-3 different dimension types.

These indicators fall under a wide range of categories including:
- BMI, nutrition, health technologies, tobacco control. Child health, communicable diseases, mental health, immunization, violence prevention, STIs, health equity, health regulations, WASH (water, sanitation, and hygiene), violence against women, tropical diseases, public health and environment, dementia, women and health, resources for substance use disorders, world health statistics, HIV/AIDS, noncommunicable diseases, health workforce, global health estimates, antimicrobial resistance, malaria, air pollution, global information system on alcohol and health, health systems, maternal and reproductive health, universal health coverage, tuberculosis

### Notes and Caveats
1. WHO GHO has data with observations for place types that are not already in our schema. This import only imports the data for Country level.

#### Template MCFs
- [who_stats.tmcf](who_stats.tmcf)

#### Other Files
- [curated_dim_map.json](curated_dim_map.json): manually curated schema mapping for dimension types and values, and the manually curated list of dimensions that indicate populationType of person
- [curated_dim.mcf](curated_dim.mcf): The manually curated schema for select dimension types and values
- [curated_sv_dcid_map.json](curated_sv_dcid_map.json): Map of autogenerated stat var dcids to the manually curated stat var dcid that should be used instead
#### Scripts
- [import_data.py](import_data.py): Script to generate the clean csv, statistical variable mcf files, and schema mcf files needed for importing the WHO GHO dataset. Also outputs skipped_mcf_sv.json file that gives information about stat vars that don't have an mcf node generated (map of dcid without mcf node generated to list of autogenerated dcids that use this dcid)
- [download_data.py](download_data.py): Script to download all the who gho observations data from the who site.
#### Generated Files
The following are the files generated by the [import_data.py](import_data.py) script
- who_schema.csv: the csv file to be imported for all the stat vars with a curated sv dcid (i.e., stat vars in curated_sv_dcid_map.json)
- who_schemaless.csv: the csv file to be imported for all the stat vars without a curated sv dcid (i.e., stat vars NOT in curated_sv_dcid_map.json)
- who_sv.mcf: the mcf file for all the autogenerated stat vars
- who_generated_schema.mcf: the autogenerated schema nodes used by the autogenerated stat vars
- skipped_mcf_sv.json: a map of curated sv dcid to list of autogenerated sv dcids that are using the curated sv dcid
## Import Procedure

>To import WHO GHO data:
1. Get the raw data in one of 2 ways:
    - To get the pre-downloaded data from our Google Cloud Storage, run and then unzip the file:
     ```
     gsutil cp gs://datcom-source-data/who/gho/indicator_data.zip .
     ```
    - To download data using the WHO API (this can take about 1 hour), run:
     ```
     python3 download_data.py --output=<folder to download data into>
     ```
3. If there are autogenerated sv dcids that should to be replaced, update [curated_sv_dcid_map.json](curated_sv_dcid_map.json) with autogenerated stat var dcids as keys and replacement stat var dcids as values.
2. Process the raw data to get all the pieces needed for import by running:
```
python3 import_data.py --data_dir=<folder holding the raw data> --curated_dim_file=curated_dim_map.json --curated_sv_file=curated_sv_dcid_map.json
```

## Categories To SVGroups
We use the following url to extract the categories that each WHO-GHO indicator belongs to:
https://www.who.int/data/gho/data/indicators

There is no API access to this category mapping. Therefore, this mapping was extracted manually.
Note that the mapping available at the url above is from a Main Category to a Sub Category to the
Indicator Name. This is the same name being used as the StatVar name by the import procedure
described above. 
