# Importing WHO GHO Indicator Categories Into Data Commons

Author: jehangiramjad

## Table of Contents

1. [About the Dataset](#about-the-dataset)
1. [Import Procedure](#import-procedure)
1. [Categories to StatVar Groups](#e2e-unit-test)

## About the Dataset

This directory imports the [WHO GHO Indicator Categories](https://www.who.int/data/gho) into Data Commons. The WHOâ€™s Global Health Observatory website provides access to data for over 2300 indicators and each indicator can be further broken down by 0-3 different dimension types. The parent directory is responsible for importing the indicator data as Statistical Variables. In this directory, we import the categories and also assign the indicator Statistical Variables to categories. These categories are called Statistical Variable Groups (SVGs).

## Import Procedure

1. Retrieve the raw indicator to category information using the [WHO GHO API](https://www.who.int/data/gho/info/athena-api). This can be done by executing:

    ```
    $ python3 gho_categories_extractor.py
    ```

  This will produce a csv file called ```WHO_GHO_Categories.csv``` under the ```input_data/``` folder. **Note that this script can take a very long time to finish because it retrieves all the data for each indicator individually and extracts the category metadata**. If the ```WHO_GHO_Categories.csv``` csv file already exists in this repo, you do not need to re-generate it unless you want to refresh it.

2. Get the existing StatVar mcf file for all WHO GHO indicators (generated by the scripts in the parent directory) or from within google3 at the following location: ```google3/datacommons/import/mcf/resolved_mcf/raw_stat_vars/who_gho/who_gho_stat_vars.mcf```. This file needs to be copied over to the ```input_data/``` folder as well.

3. Execute the main script which produces two files in the ```output/``` folder:

  (a) Generates an mcf file for the StatVarGroups (categories);

  (b) Generates an updated mcf file for the WHO GHO Indicator StatVars which now includes the group/category information.

4. Using the [import-tool](https://github.com/datacommonsorg/import) the validation exercise should produce no errors and no warnings. The import tool validation can invoked as:

    ```
    $ alias dc-import ='java -jar <path_to_jar>'
    $ dc-import genmcf <data_repo_path>/scripts/who/gho/gho_categories/output/*.mcf
    ```

Output from the validation should be similar (or the same as) what's shown below:

{
  "levelSummary": {
    "LEVEL_INFO": {
      "counters": {
        "Existence_NumChecks": "66990",
        "Existence_NumDcCalls": "3"
      }
    }
  },
  "commandArgs": {
    "existenceChecks": true,
    "resolution": "RESOLUTION_MODE_LOCAL",
    "numThreads": 1,
    "statChecks": true
  }
}

## E2E Unit Test

To run unit tests:

      ```
      python3 -m unittest discover -v -s ../ -p "*_test.py"
      ```
