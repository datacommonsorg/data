# Importing the United States Adopted Names (USAN) data

## Table of Contents

1. [About the Dataset](#about-the-dataset)
    1. [Download URL](#download-urls)
    2. [Overview](#overview)
    3. [Notes and Caveats](#notes-and-caveats)
    4. [dcid Generation](#dcid-generation)
    5. [License](#license)
2. [About the Import](#about-the-import)
    1. [Artifacts](#artifacts)
       1. [New Schema](#new-schema)
       2. [Scripts](#scripts)
       3. [tMCFs](#tmcfs)
    2. [Import Procedure](#import-procedure)
    3. [Tests](#tests)

## About the Dataset

The [United States Adopted Names (USAN) Council](https://www.ama-assn.org/about/united-states-adopted-names/usan-council) is co-sponsored by the American Medical Association, the United States Pharmacopeial Convention, Inc., and the American Pharmaceutical Association. The USAN Councilâ€™s goal is to provide meaningful designations for compounds, enhancing prescribing and patient safety. It was organized in 1964 to represent the health professions in the selection of appropriate nonproprietary names for drugs.

[USAN stems](https://www.ama-assn.org/about/united-states-adopted-names/united-states-adopted-names-approved-stems) represent common stems for which chemical and/or pharmacologic parameters have been established. These council-approved stems and their definitions are recommended for use in coining new nonproprietary drug names belonging to an established series of related agents. This provides meaningful designations for compounds that enhance prescription and patient safety. USAN appropriately incorporates this established class stem system. By doing so, similar compounds maintain a common "family" name that provides immediate recognition. 

### Download Data

The USAN stem data can be downloaded from their website [here](https://www.ama-assn.org/about/united-states-adopted-names/united-states-adopted-names-approved-stems). The data is in `.xlsx` format and had to be parsed first converted into a `.csv` format  (see [Notes and Caveats](#notes-and-caveats) for additional information on formatting) for further data preprocessing. For the convenience of users, we have provided a raw .csv version of the data in this repository because viewing the raw .xlsx version is unsupported in many systems.

### Overview

This directory stores the script used to clean and convert the United States Adopted Names data into a `.csv` format, which is ready for ingestion into the Data Commons knowledge graph alongside a `.tmcf` file that maps the `.csv` to the defined schema. In this import the data is ingested as [USAdoptedNameStem](https://datacommons.org/browser/USAdoptedNameStem) entities into the graph.

The USAN Stem ID is mapped to other properties, namely, its name, definition, examples, stem type, word stem, specialization and year of creation.

### Notes and Caveats

The original format of the data was `.xlsx` and it was converted to a `.csv` file prior to ingestion into Data Commons. There are a couple of quirks in the formatting of the original `.xlsx` file that needed to be taken into account during the data cleaning. First, subgroups do not have a stated stem in the 'Stem' column. In these cases the 'Prefix (xxx-), Infix (-xxx-), or Suffix (-xxx)' column is used for the stem stripped of '-'. In addition, a new column 'specializationOf' was added to link subgroups to their parent node. These are recognized by the text 'subgroups:' appearing in the 'Stem' column. Any subgroup entry, which have info in any column except 'Stem', that occur at or below the 'subgroup' line will be linked to the last node with an entry in the 'Stem' column. This will continue until the next potential parent stem is reached as denoted by the inclusion of the stem name in the 'Stem' column. Furthermore, there are USAN stems that are represented by two equivalent terms seperated by either a ',' ,'/', or 'or' in the 'Stem' column. In these cases a dcid is generated for each seperate term (e.g. 'tril/trillat' becomes'chem/tril' and 'chem/trilat') and the nodes are recognized as equivalent using the 'sameAs' term. Finally in the case of subgroups 'som- -bove' and 'som- -por' the dcids were created by joining the terms together (e.g. chem/sombove). They are both recognized as 'specializationsOf: dcs:chem/som'. They also are recognized as having two 'wordElementType' both prefix and suffix. They are the only entries that are belonging to multiple 'wordElementType' enumerations.

### dcid Generation

Dcids were generated by adding the prefix 'chem/' to the stem (e.g. chem/apsel). In the cases of subgroups the 'Prefix (xxx-), Infix (-xxx-), or Suffix (-xxx)' column is used for the stem stripped of '-'. In the cases of multiple stems representing a USAN Stem (e.g. 'tril/trillat') a dcid for each stem is made (e.g. 'chem/tril' and 'chem/trilat') and the nodes are recognized as the same by linking to each other using the 'sameAs' property.

### License

This data is made available through [openFDA terms of service](https://open.fda.gov/license/).

## About the import

### Artifacts

#### New Schema

Classes, properties, and enumerations that were added in this import to represent the data.

* Classes
    * USAdoptedNameStem
* Properties
    * USAdoptedNameStem: wordElementType
* Enumerations
    * WordElementTypeEnum

#### Scripts

##### Bash Scripts

- [download.sh](scripts/download.sh) downloads the most recent release of USAN Stems.
- [run.sh](scripts/run.sh) cleans the usan `.xlsx` file and formats it into a `.csv` for importing.
- [tests.sh](scripts/tests.sh) runs standard tests on CSV + tMCF pairs to check for proper formatting.

##### Python Script

[`format_usan.py`](scripts/format_usan.py) parses the .csv file and converts it into a .csv with USAN stems mapped to their corresponding word stems.


##### tMCF File

[`usan.tmcf`](tMCFs/usan.tmcf) contains the tmcf mapping to the csv file, to generate an accurate tmcf-csv pair.

### Import Procedure

Download the most recent versions of the USAN stems from the US Adopted Name Council:

```bash
sh download.sh
```

Generate the cleaned and formatted csv file ready for import:

```bash
sh run.sh
```

### Tests

The first step of `tests.sh` is to downloads Data Commons's java -jar import tool, storing it in a `tmp` directory. This assumes that the user has Java Runtime Environment (JRE) installed. This tool is described in Data Commons documentation of the [import pipeline](https://github.com/datacommonsorg/import/). The relases of the tool can be viewed [here](https://github.com/datacommonsorg/import/releases/). Here we download version `0.1-alpha.1k` and apply it to check our csv + tmcf import. It evaluates if all schema used in the import is present in the graph, all referenced nodes are present in the graph, along with other checks that issue fatal errors, errors, or warnings upon failing checks. Please note that empty tokens for some columns are expected as this reflects the original data. The imports create the USAdoptedName nodes that are then refrenced within this import. This resolves any concern about missing reference warnings concerning these node types by the test.

To run tests:

```bash
sh tests.sh
```
