# Importing NCBI ClinVar 

## Table of Contents

1. [About the Dataset](#about-the-dataset)
    1. [Download URL](#download-url)
    2. [Database Overview](#database-overview)
    3. [Schema Overview](#schema-overview)
       1. [New Schema](#new-schema)
       2. [dcid Generation](#dcid-generation)
       3. [enum Generation](#enum-generation)
       4. [Edges](#edges)
    4. [Notes and Caveats](#notes-and-caveats)
    5. [License](#license)
    6. [Dataset Documentation and Relevant Links](#dataset-documentation-and-relevant-links)
2. [About the Import](#about-the-import)
    1. [Artifacts](#artifacts)
    2. [Import Procedure](#import-procedure)
    3. [Test](#test)
    4. [Sample](#sample-data)


## About the Dataset

Need to update

### Download URL

NCBI ClinVar data can be downloaded from the National Center for Biotechnology Information (NCBI) using their FTP Site
1. [hg38_clinvar](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar.vcf.gz). 
2. [hg38_clinvar_papu](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar_papu.vcf.gz).
3. [hg19_clinvar](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh37/clinvar.vcf.gz). 
4. [hg19_clinvar_papu](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh37/clinvar_papu.vcf.gz).


### Database Overview

Need to update

### Schema Overview

##### Classes

* Taxon 
    * GenomicPosition -> GeneticVariant -> GeneticVariantPopulationFrequency -> GeneticVariantConflictingClinicalSignificanceReport
  
##### Properties

* GenomicPosition
    * name
    * chrom
    * inGenomeAssembly
    * position
    
* GeneticVariant
    *  name
    *  alleleOrigin
    *  associatedDiseaseName
    *  associatedDrugResponseEfficacy
    *  canonicalAlleleID
    *  catalogueOfSomaticMutationsInCancerID
    *  clinicalSignificanceCategory
    *  clinicalSignificanceCategory
    *  clinicalSignificance
    *  clinVarAlleleID
    *  clinVarGermlineReviewStatus
    *  clinVarOncogenicityReviewStatus
    *  clinVarSomaticReviewStatus
    *  chrom
    *  dbVarID
    *  experimentalFactorOntologyID
    *  geneID
    *  geneSymbol
    *  geneticTestingRegistryID
    *  geneticVariantClass
    *  geneticVariantFunctionalCategory
    *  hbVarID
    *  hg19GenomicPosition
    *  hgvsNomenclature
    *  humanPhenotypeOntologyID
    *  inChromosome
    *  leidenOpenVariationDatabaseID
    *  medicalSubjectHeadingID
    *  mitochondrialDiseaseSequenceDataResourceID
    *  mondoID
    *  ncbiGeneID
    *  ncbiGeneID
    *  observedAllele
    *  omimID
    *  omimID
    *  orphaNumber
    *  pharmgkbClinicalAnnotationID
    *  referenceAllele
    *  rsID
    *  sequenceOntologyID
    *  sequenceOntologyID
    *  snomedCT
    *  umlsConceptUniqueID
    *  uniProtID
    *  uniProtKBSwissProtID

* GeneticVariantPopulationFrequency
    * name
    * alleleFrequency
    * geneticVaraintID
    * measuredProperty
    * measuredPopulation
    * rsID

* GeneticVariantConflictingClinicalSignificanceReport
    * name
    * alleleType
    * geneticVaraintID
    * clinicalSignificance
    * geneticVariantID
    * reportCount

  
##### Enumerations

 * NA
 
##### Enumeartions Generated By Script

* NA


#### dcid Generation

The data for each entry in NCBI ClinVar was stored as a GeneticVariant entity. The dcid for these entities was generated by adding the prefix "bio/VariationID" or "bio/rs" to the rsID.

#### enum Generation

NA

#### Edges

Need to update


### Notes and Caveats

* Data Consistency and Quality: 
    
    Rank Changes: Taxonomic classifications are subject to change, necessitating regular data refreshes.
    
    Parent-Child Relationships: Verify the accuracy of parent-child relationships between Taxon.

* Mapping file for tax_id and dcid:
    
    This import relies on the tax_id_dcid_mapping file, which is generated as output from the Taxonomy import.

### License

Need to update


### Dataset Documentation and Relevant Links

Need to update

## About the import

### Artifacts

#### Scripts

##### Bash Scripts

- [download.sh](download.sh) downloads the most recent release of the NCBI ClinVar data.
- [run.sh](run.sh) generates a cleaned CSV output.
- [tests.sh](tests.sh) runs standard tests on CSV + tMCF pairs to check for proper formatting.

##### Python Scripts

- [format_clinvar_and_position.py](scripts/format_clinvar_and_position.py) creates the formatted CSV files.
- [format_clinvar_and_position_test.py](scripts/format_clinvar_and_position_test.py) unittest script to test standard test cases on cleaned output CSV.

#### tMCFs
[clinvar.tmcf](tMCFs/clinvar.tmcf)
[clinvar_obs.tmcf](tMCFs/clinvar_obs.tmcf) 
[clinvar_conflicting.tmcf](tMCFs/clinvar_conflicting.tmcf) 
[clinvar_pos_only](tMCFs/clinvar_pos_only.tmcf) 

### Import Procedure

Download the most recent versions of NCBI ClinVar data:

```bash
sh download.sh
```

Generate the formatted CSV:

```bash
sh run.sh
```

### Tests

The first step of `tests.sh` is to downloads Data Commons's java -jar import tool, storing it in a `tmp` directory. This assumes that the user has Java Runtime Environment (JRE) installed. This tool is described in Data Commons documentation of the [import pipeline](https://github.com/datacommonsorg/import/). The relases of the tool can be viewed [here](https://github.com/datacommonsorg/import/releases/). Here we download version `0.1-alpha.1k` and apply it to check our csv + tmcf import. It evaluates if all schema used in the import is present in the graph, all referenced nodes are present in the graph, along with other checks that issue fatal errors, errors, or warnings upon failing checks. Please note that empty tokens for some columns are expected as this reflects the original data. The imports create the Virus nodes that are then referenced within this import. This resolves any concern about missing reference warnings concerning these node types by the test.

To run tests:

```bash
sh tests.sh
```

This will generate an output file for the results of the tests on each csv + tmcf pair

### Sample Data

This sample [dataset](/scripts/biomedical/NCBI_ClinVar/test_data/) is a representative subset of the larger dataset. It was selected using stratified sampling to ensure that it covers most of the of scenarios in the data cleaning functionality This can be used for testing purpose.

The sample input and output data are located at the following links:

Input data: [input_link](test_data/input)
Output data: [output_link](test_data/output)