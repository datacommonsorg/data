# Importing NCBI Gene 

## Table of Contents

1. [About the Dataset](#about-the-dataset)
    1. [Download URL](#download-url)
    2. [Database Overview](#database-overview)
    3. [Schema Overview](#schema-overview)
       1. [New Schema](#new-schema)
       2. [dcid Generation](#dcid-generation)
       3. [enum Generation](#enum-generation)
       4. [Edges](#edges)
    4. [Notes and Caveats](#notes-and-caveats)
    5. [License](#license)
    6. [Dataset Documentation and Relevant Links](#dataset-documentation-and-relevant-links)
2. [About the Import](#about-the-import)
    1. [Artifacts](#artifacts)
    2. [Import Procedure](#import-procedure)
    3. [Test](#test)
    4. [Sample](#sample-data)


## About the Dataset

Need to update

### Download URL

NCBI Gene data can be downloaded from the National Center for Biotechnology Information (NCBI) using their FTP Site
1. [NCBI Gene](https://ftp.ncbi.nih.gov/gene/DATA/gene_info.gz). 
2. [gene2pubmed](https://ftp.ncbi.nih.gov/gene/DATA/gene2pubmed.gz).
3. [gene_neighbors](https://ftp.ncbi.nih.gov/gene/DATA/gene_neighbors.gz). 
4. [gene_orthologs](https://ftp.ncbi.nih.gov/gene/DATA/gene_orthologs.gz).
5. [gene_group](https://ftp.ncbi.nih.gov/gene/DATA/gene_group.gz). 
6. [mim2gene_medgen](https://ftp.ncbi.nih.gov/gene/DATA/mim2gene_medgen).
7. [gene2go](https://ftp.ncbi.nih.gov/gene/DATA/gene2go.gz). 
8. [gene2accession](https://ftp.ncbi.nih.gov/gene/DATA/gene2accession.gz).
9. [gene2ensembl](https://ftp.ncbi.nih.gov/gene/DATA/gene2ensembl.gz). 
10. [generifs_basic](https://ftp.ncbi.nih.gov/gene/GeneRIF/generifs_basic.gz).


### Database Overview

Need to update

### Schema Overview

##### Classes

* Taxon 
    * Thing -> BioChemEntity -> BiomedicalEntity -> BiologicalEntity -> GenomeAnnotation -> Taxon -> Gene
  
##### Properties

* Gene
    * geneID
    * synonym
    * chrom
    * cytogeneticMapLocation
    * description
    * fullName
    * nomenclatureStatus
    * dateModified
    * refSeqFunctionElementFeatureAnnotation
    * geneSymbol
    * pubMedID
    * geneOrtholog
    * genePotentialReadthroughSibling
    * geneReadthroughChild
    * geneReadthroughParent
    * geneReadthroughSibling
    * geneRegionMember
    * geneRegionParent
    * relatedFunctionalGene
    * relatedPseudogene
    * ncbiSequenceGiNumber
    * refSeqGenomicAccessionVersion
    * ensemblGeneId
    and multiple database id's

* GenomicCoordinates
    * chrom
    * chromEnd
    * chromStart
    * inGenomeAssembly
    * strandOrientation
    * hasGenomicCoordinates
    * ncbiSequenceGiNumber
    * refSeqGenomicAccessionVersion
* RnaTranscript
    * hasGenomicCoordinates
    * ncbiMaturePeptideGiNumber
    * ncbiProteinGiNumber
    * ncbiRnaNucleotideGiNumber
    * refSeqMaturePeptideAccession
    * refSeqProteinAccession
    * refSeqRnaNucleotideAccession
    * transcribedFromGene
    * ensemblProteinId
    * ensemblRnaId

* GeneReferenceIntoFunction
    * dateModified
    * geneID
    * geneReferenceIntoFunction
    * pubMedID


* MedGenConceptUniqueIdentifier
    * conceptUniqueIdentifier
    * 

* MendelianInheritanceInManEntity
    * conceptUniqueIdentifier
    * onlineMendelianInheritanceInManID

* GeneMendelianInheritanceInManIdentifierAssociation
    * geneOmimRelationshipComment
    * geneOmimRelationshipSource
    * geneOmimRelationshipType
  
##### Enumerations

 * GeneFeatureTypeEnum
 
##### Enumeartions Generated By Script

* GeneFeatureTypeRegulatoryEnum
* GeneFeatureTypeMiscellaneousEnum
* GeneFeatureTypeMiscellaneousRecombinationEnum

#### dcid Generation

The data for each entry in NCBI Gene was stored as a Gene entity. The dcid for these entities was generated by adding the prefix "bio/" to the GeneID.

#### enum Generation

The schema for the GeneFeatureTypeRegulatoryEnum, GeneFeatureTypeMiscellaneousEnum and GeneFeatureTypeMiscellaneousRecombinationEnum are autogenerated by `format_ncbi_gene.py`.

A sample auto generated schema file saves at [ncbi_gene_schema_enum.mcf](/scripts/biomedical/NCBI_Gene/test_data/sample_enum/ncbi_gene_schema_enum.mcf) for reference

#### Edges

Need to update


### Notes and Caveats

* Data Consistency and Quality: 
    
    Rank Changes: Taxonomic classifications are subject to change, necessitating regular data refreshes.
    
    Parent-Child Relationships: Verify the accuracy of parent-child relationships between Taxon.

* Mapping file for tax_id and dcid:
    
    This import relies on the tax_id_dcid_mapping file, which is generated as output from the Taxonomy import.

### License

Need to update


### Dataset Documentation and Relevant Links

Need to update

## About the import

### Artifacts

#### Scripts

##### Bash Scripts

- [download.sh](download.sh) downloads the most recent release of the NCBI Gene data.
- [run.sh](run.sh) it divides large files into smaller shards, generates a cleaned CSV output, and creates an enum schema MCF.
- [tests.sh](tests.sh) runs standard tests on CSV + tMCF pairs to check for proper formatting.

##### Python Scripts

- [format_ncbi_gene.py](scripts/format_ncbi_gene.py) creates the Gene schema enum MCF and formatted CSV files.
- [format_ncbi_taxonomy_test.py](scripts/format_ncbi_gene_test.py) unittest script to test standard test cases on gene enum MCF & cleaned output CSV.

#### tMCFs
[ncbi_gene_gene.tmcf](tMCFs/ncbi_gene_gene.tmcf)
[ncbi_gene_gene_db.tmcf](tMCFs/ncbi_gene_gene_db.tmcf) 
[ncbi_gene_ensembl.tmcf](tMCFs/ncbi_gene_ensembl.tmcf) 
[ncbi_gene_gene_group](tMCFs/ncbi_gene_gene_group.tmcf) 
[ncbi_gene_gene_rif.tmcf](tMCFs/ncbi_gene_gene_rif.tmcf) 
[ncbi_gene_genomic_coordinates.tmcf](tMCFs/ncbi_gene_genomic_coordinates.tmcf) 
[ncbi_gene_go_terms.tmcf](tMCFs/ncbi_gene_go_terms.tmcf) 
[ncbi_gene_ortholog.tmcf](tMCFs/ncbi_gene_ortholog.tmcf) 
[ncbi_gene_phenotype_associations.tmcf](tMCFs/ncbi_gene_phenotype_associations.tmcf) 
[ncbi_gene_pubmed.tmcf](tMCFs/ncbi_gene_pubmed.tmcf) 
[ncbi_gene_rna_transcript.tmcf](tMCFs/ncbi_gene_rna_transcript.tmcf)

### Import Procedure

Download the most recent versions of NCBI Gene data:

```bash
sh download.sh
```

Generate the enum schema MCF & formatted CSV:

```bash
sh run.sh
```

### Tests

The first step of `tests.sh` is to downloads Data Commons's java -jar import tool, storing it in a `tmp` directory. This assumes that the user has Java Runtime Environment (JRE) installed. This tool is described in Data Commons documentation of the [import pipeline](https://github.com/datacommonsorg/import/). The relases of the tool can be viewed [here](https://github.com/datacommonsorg/import/releases/). Here we download version `0.1-alpha.1k` and apply it to check our csv + tmcf import. It evaluates if all schema used in the import is present in the graph, all referenced nodes are present in the graph, along with other checks that issue fatal errors, errors, or warnings upon failing checks. Please note that empty tokens for some columns are expected as this reflects the original data. The imports create the Virus nodes that are then referenced within this import. This resolves any concern about missing reference warnings concerning these node types by the test.

To run tests:

```bash
sh tests.sh
```

This will generate an output file for the results of the tests on each csv + tmcf pair

### Sample Data

This sample [dataset](/scripts/biomedical/NCBI_Gene/test_data/) is a representative subset of the larger dataset. It was selected using stratified sampling to ensure that it covers most of the of scenarios in the data cleaning functionality This can be used for testing purpose.

The sample input and output data are located at the following links:

Input data: [input_link](test_data/input)
Output data: [output_link](test_data/expected_output)