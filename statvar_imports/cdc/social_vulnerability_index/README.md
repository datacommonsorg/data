# CDC - Social Vulnerability Index

- source: https://www.atsdr.cdc.gov/placeandhealth/svi/data_documentation_download.html. 

- how to download data: Manual download from source based on years, filters - Year, Geography - US, Geography Type - County.

- type of place: Counties.

- statvars: Demographics, Health

- years: 2010 to 2022

- place_resolution: County places are resolved based on FIPS code in data.

##  How to Run Manually

Example command to run the processor:

```bash
python3 ../../../tools/statvar_importer/stat_var_processor.py \
    --input_data=test_data/SVI_2022_US_county_input.csv \
    --pv_map=pvmap.csv \
    --config_file=metadata.csv \
    --output_path=test_data/
  
```

## Automation (via Manifest)
The automated import is controlled by a manifest file and runs the following flow:

Steps:
Creates the source_files/ directory if not already present.

Copies all latest input .csv files from GCS using:

bash

gsutil cp gs://unresolved_mcf/cdc/social_vulnerability_index/latest/input_files/* source_files/

Adds a year column using add_years.py:

For 2010: file is placed under source_files/2010/ without modification.

For other years: file is updated in place in source_files/.

Runs stat_var_processor.py:

SVI_2010_US_county.csv → processed with specific pvmap and metadata.

Other year files → processed with shared pvmap.csv and metadata.csv.


##  Manual GCS Upload Instructions
When new year data is released:

Download the latest .csv/xlsx file manually from the CDC SVI source page.

##  Upload the file to the GCS bucket:

bash

gsutil cp <local_csv_file> gs://unresolved_mcf/cdc/social_vulnerability_index/latest/input_files/

##  Ensure the file is named using the format:
SVI_<year>_US_county.csv (e.g., SVI_2024_US_county.csv)

Once uploaded, re-run the manifest pipeline and it will automatically process the new file.

##  Example Output Files
After automation, output files are saved as:

output/SVI_2010_us_county.csv

output/SVI_2010_us_county.tmcf

output/SVI_us_county.csv (for other years combined)

output/SVI_us_county.tmcf
